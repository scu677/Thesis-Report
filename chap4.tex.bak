\chapter{Implemetation}
\label{chap:ch4_abbr}
\label{chap:figtab}
\section{Review}
The software implementation showcase the functionality of all the requirements as described previously. This functionality include the ability to input data and retrieve data through the system. Proper measures has been be considered to obtained maximum result as required. This measure includes the choice of tools used for the developement and the design approach. It was implemented to demonstrate the realization of the proposed specifications especialy features such as making reservations in the system.
\section{Implementation tools}
 The user interface is implemented on the internet web browser using apeche local server port as web address. The web browser serves as the environment for testing the frontend (user interface) of the software, and while the HTML template and Go library is used for the development. The database was developed using the SQLite model schema which is coded with Go language.  This platform provides robust query funtionality for creating several data schema. The HTTP server provides connections between the frontend and backend implementation. It server as a channel for parsing command protocol through user interface and database. We used local port to represent  web address for this  implemeting.  These tools provided all the necessary component to address the requirements for this software. 
\section{Program Structure}
The Go programming language has a fundamental developemtn structure that is categorized into packages. The packages contains a group of program file with dependencies that links them together. For this software design, we have used two main package to actualize the develpment goal. These packages inludes:
\begin{description}
\item[$\bullet$]Database package 
\item[$\bullet$]HTTP package 
\end{description}

The database package contains all the Go files with database related method (struct) and functions. Each Go class or struct of hardware represented in the system depends on this package for communicationg with other classes and database resources. The HTTP package also contain some Go file relates to the user interface ( for example the funtion Handler) and HTML files. the HTML files contians several templates for the web interface content and elements. These file depends on the HTTP package for serving the web contents and post requests. Below is a table describing the list of header files in each packages.
\pagebreak
\begin{table}[h!]
  \centering
  \label{tab:table1}
  \begin{tabular}{ccc}
    \hline
    No & Package & Files\\
   \hline
    1 &Database (pkg)& Machine.go\\
       &&Reservation.go\\
      &&Disk.go\\
      &&User.go\\
      &&nic.go\\
    \hline
    2 &HTTP (pkg)& Handler.go\\
    &&Server.go\\
    &&Templates(.html)\\
    \hline
  \end{tabular}
  \caption{Program package}
\end{table}

\section{List of Funtions}
The functions contains group of statements that perform the tasks specified in the software requirement. It contains the algorithms that process different  queries and schema actions. The method fields contains the entities of the hardware represented in the system, and this feilds are used as argumet in the various functions. 
\begin{table}[h!]
  \centering
  \label{tab:table1}
  \begin{tabular}{l|c||r}
    No & Struct& Functions\\
    \hline
    1 &machine() &  initMachines()\\
      && CreateMachine()\\
      &&UpdateMachine()\\
      &&GetMachines()\\
      &&GetAvailableMachine()\\
     \hline
    2 &reservation() & initReservation\\
    && CreateReservation()\\
    && GetReservation()\\
    && FilterReservation()\\
    && SortReservation()\\
    \hline
    3 &disks() & intiDisks\\
    && CreateDisks()\\
    \hline
    4 &nics() & initNICs\\
    && CreateNICs
  \end{tabular}
  \caption{List of Funtions}
\end{table}

\pagebreak
\section{Description of Functions}
\section*{Adding Machines to the system}
Adding machines and other devices to the system is one of the software  requirements. On the user interface, the software provides a text feild and forms where users can enter details of machines to be saved as data in the database. The SQLite Init funtion create a new database schema with defined table feilds where data is stored. When the user submit a AddMachine form, the InitMachine() create the database schema where the machine details is stored. It uses type (Machine) feilds as argument for creating the schema feilds. Below is the code listing for creating database:

\begin{lstlisting}[caption=Creating Database for machine, label=Intitializing database]
func initMachines(tx *sql.Tx) error {
	_, err := tx.Exec(`
	CREATE TABLE Machines(
		...........
	);`)
	return err
}
\end{lstlisting}

The CreateMachine function is reponsible for parsing the details of machine to the database schema. It uses the SQLite insert query to parse a give data using the arguments to the database. When the user submit a form (AddMachine), the Go HTTP handler process this form by converting the plan text to a formdata accroding to their data types defined in the schema, and then call the CreateMachine to insert this data to the database. Below is the code list:

SPEUDOCODE:\linebreak
1 Initialize database values to zero
\linebreak
2 Open the database and check for error.\linebreak
3 Input values into the database.\linebreak
4 If value format is ok, stored values and return.

\begin{lstlisting}[caption=Adding machines details, label=Adding machine]
func (d DB) CreateMachine(name string, arch string,
	microarch string, cores int, memoryGB int) error {
	_, err := d.sql.Exec(`
			INSERT INTO Machines(name, arch, microarch,
			 cores, memory)
			VALUES (
				//feild values
			)`,
		name, arch, microarch, cores, memoryGB)
	return err
}
\end{lstlisting}

\section*{Making a Reservation}
The reservation process is similar to creating a machine but here it required the UserID and MachineID as froeign keys in creating the database schema. The UserID is used for selecting  the user making the reservation, and MachineID for selecting the machine to be reserved. On the web interface (reservation page), the form has a drop down list where users can select their username and the machine they want to reserve. When users open the reservation page to create new revervation, the HTML form use the post request to get list of machines and username on the dropdown list.
PSEUDOCODE:\linebreak
1 Initialize database table to zero.\linebreak
2 Open the database schema and check for error.\linebreak
3 Input reservation values in the feild.\linebreak
4 Select machine id from the list where machine name is chosen.\linebreak
5 Select user id from the list of user where name is chosen.\linebreak
6 insert all the values to reservation table and return.\linebreak
\begin{lstlisting}[caption=Storing Reservation details, label=Adding reservation]
	_, err := d.sql.Exec(`
			INSERT INTO Reservations(machine,user,start,end,
			pxepath,nfsroot)
			VALUES (
				(SELECT id from Machines where name=?),
				(SELECT id from Users where username=?),
				//other fields
			)`,
\end{lstlisting}

To make a reservation, users will select their username and a machine from the drop down list which is loaded by GetMachine and GetUser function. The selection query gets the UserId and the MachineId of the selected username and machine as foriegn key to the reservation database shema. Also, start and end time/date of the reservation is entered on th text feild , and this plan text is formated to match the database using a time package in Go library. After submiting the form, the Go HTTP handler handles the Insert query by taking all the arguement values and saving them to database. 
\section*{Checking Available Machines}
The user can search the inventory for specific imformation. One of the example is the ability to search for available machines in the system. Available machines are those machine that are either not reserved at the moment or that are free for a certain period. This feature helps users to get list of machine free to be reserved. In this process of checking available machine, the user enters a specific start date and end date in the provided text feild, and submit the query. After submiting the query, the HTTP handler process this request, and the server calls the GetAvailableMachine method (function) to fetch this request from the database. Go HTTP handler uses a Request functon to call the server and  ResponseWriter to respond to the html request \cite{Gohttp}. The server uses ListernAndServe method to listen to incoming request and to sall the requested method to handle the request. In the GetAvalaibleMachine method, we used a SQLite sub query tech to combine the machine and reservation database table. This combination logic allows the query to scan through both table rows using reservationID and machineID to indentify the machines that are not reserved for that time range the user entered. The logic contains SQL WHERE cluase, OR and AND operator to perform comparisons between reservation dates and time. \cite{ANDOR}The AND operator is used to allow multiple conditions in the statement,  the OR operator is used to combine condition that are true, and the WHERE clause is used to specify condition while fetching data from database\cite{WHEREclause}. 
\pagebreak
Below code listing shows the function and query for this operation:
SPEUDOCODE:
1 Open the database schema and check for error.\linebreak
2 Query the database  and select machine values where Id is not in reservation
\linebreak
3 Select machine values where its reserved and query date is between a start or date entered. \linebreak
4 And  select machine values where start or end date is between the query date.\linebreak
5 Assign the selected values to the row and return the values.\linebreak
\begin{lstlisting}[caption=Searching available, label=Search available machine]
func(d DB) Filter_M_By_Dates(from time.Time, to time.Time) ([]Machine, error){

         rows, err := d.sql.Query(`
		SELECT m.id, name, arch, microarch, cores, memory
		FROM Machines m
		WHERE m.id NOT IN (SELECT r.machine FROM Reservations r
		WHERE (? BETWEEN r.start AND r.end)
		OR (? BETWEEN r.start AND r.end)
		AND  ( r.start BETWEEN ? AND ?) OR (r.end BETWEEN ? AND ?)
	
	);	
	`, from, to, from, to, from, to)


\end{lstlisting}
\section*{Updating Machines details}
As part of the software requirements, users can change the information stored in the database. This is done on the wen interface using edit box that is attached to every feild with that requirement. Example is updating the information of a particular computer or disks when the hardware is upgraded. In this case, the UpdateMachine method performs this action by using the SQLite update query. This update query opens the database schema of the machine and replaces the existing data with a new one.
Below code listing shows the update function:
\begin{lstlisting}[caption=Function for Updating data, label=Update function]

	_, err := d.sql.Exec(`
			UPDATE Machines
			SET arch = ?, microarch = ?, cores = ?, memory = ?
			WHERE `+row+` = id

	`,arch, microarch, cores, memory)

\end{lstlisting}
\section{Get Funtions}
The Get function is a mothod used for fetching list of machines and other devices stored in the database. Each time the user opens the web interface, the HTTP handler send server a request and server calls the GetMachines method to fetch the data from database. This information is listed in the inventory on the web interface through the HTTP ResponseWriter. The Get futction uses the SQLite selection query to scan throught the database and select the required data.  Another usage for this Get function is fetching the details of a machine when the user click on a particular machine. It uses a SELECT query and WHERE condition in the logic, to speciy the machine clicked used its unique ID. These mehtods is applicable to other classes (type) such as, disks, nices and reservations. 
 
\section{Problems Encounted}
During the implemetations, we encountered problems such as formating plain text to database data types, and combining two database table for search queries. We solve this query proplem by using SQL join function, which normally open two database and scan through them same time to compare different information.



